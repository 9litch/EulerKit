def date
  DateTime.now.strftime("%Y-%m-%d %H:%M:%S")
end

def git_branch
  `git symbolic-ref --short -q HEAD`.strip
end

def git_commit(files = [])
  file_str = files.is_a?(Array) ? files.join(" ") : files
  execute("git add #{file_str}")
  execute("git commit -m \"auto-commit on file save at #{date}\"")
end

# .kick is usually filterd out by the ReloadDotKick handler
# this is run when .kick is reloaded, so add it to git now
if git_branch == "auto-commit"
  git_commit(".kick")
end

process do |files|
  if git_branch == 'auto-commit'
    git_commit(files)
    files.clear
  else
    puts "Not processing files on the #{branch} branch"
    files.clear
  end
end